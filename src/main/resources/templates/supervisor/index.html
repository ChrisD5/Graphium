<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header('Home | Supervisor Portal')" />
<body class="bg-nord-0">

<div class="container mx-auto">
    <div th:replace="fragments/navbars/supervisor-navbar :: navbar"/>
    <div class="flex flex-col gap-4 mx-8 my-10 content-center">
        <label class="text-nord-4 font-semibold tracking-wider text-lg" th:text="${'Welcome to your dashboard, ' + supervisor.name}"></label>
        <div class="content-center shadow-lg rounded-lg overflow-hidden bg-nord-1 w-2/3">
            <canvas class="p-10" id="chartLine"></canvas>
        </div>
    </div>
</div>

</body>

<footer>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let str = "[[${employees}]]"
        let respObj = JSON.parse(str.replace(/&quot;/g,'"'));
        console.log(respObj);
        const data = {
            datasets: []
        };
        for (const emp in respObj) {
            let sortedEmp = respObj[emp].sort((a, b) => {
                return a.time - b.time;
            });
            data.datasets.push({
                label: emp,
                data: sortedEmp.map((v) => {
                    let date = new Date(v.time);
                    return {'x': `${date.getUTCDate()}/${date.getUTCMonth() + 1}`, 'y': v.rating}
                })
            })
        }
        console.log(data.datasets);

        const configLineChart = {
            type: "line",
            data,
            options: {
                plugins: {
                    legend: {
                        display: true,
                        labels: {
                            color: "#D8DEE9"
                        }
                    },
                    title: {
                        display: true,
                        color: "#D8DEE9",
                        text: "Check-In scores of your employees (past 7 weeks)"
                    }
                },
                scales: {
                    'y': {
                        type: 'category',
                        reverse: true,
                        labels: [1,2,3,4,5,6,7,8,9,10]
                    }
                }
            }
        };

        Chart.defaults.color = '#D8DEE9';
        Chart.defaults.font.size = 15;
        Chart.defaults.backgroundColor = "#D8DEE9";
        Chart.defaults.borderColor = "#D8DEE9";

        var chartLine = new Chart(
            document.getElementById("chartLine"),
            configLineChart
        );
    </script>
</footer>

<footer th:replace="fragments/footer :: footer">
</footer>
</html>